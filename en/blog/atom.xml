<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://iflytek.github.io/athena_website/en/blog</id>
    <title>AthenaServingFrameWork Doc Blog</title>
    <updated>2022-10-22T11:24:16.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://iflytek.github.io/athena_website/en/blog"/>
    <subtitle>AthenaServingFrameWork Doc Blog</subtitle>
    <icon>https://iflytek.github.io/athena_website/en/img/brand.png</icon>
    <entry>
        <title type="html"><![CDATA[快速在AthenaServing框架中部署YoLoV7]]></title>
        <id>yolov7</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/yolov7"/>
        <updated>2022-10-22T11:24:16.000Z</updated>
        <summary type="html"><![CDATA[背景]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="背景">背景<a class="hash-link" href="#背景" title="Direct link to heading">​</a></h2><blockquote><p>YOLOv7 在 5 FPS 到 160 FPS 范围内，速度和精度都超过了所有已知的目标检测器，并在 GPU V100 上，30 FPS 的情况下达到实时目标检测器的最高精度 56.8% AP。YOLOv7 是在 MS COCO 数据集上从头开始训练的，不使用任何其他数据集或预训练权重。</p></blockquote>]]></content>
        <author>
            <name>sea-wyq</name>
            <uri>https://github.com/sea-wyq</uri>
        </author>
        <category label="python" term="python"/>
        <category label="yolov7" term="yolov7"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[envd配合conda实现研究环境的快速迁移和服务部署]]></title>
        <id>envd</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/envd"/>
        <updated>2022-10-22T11:24:16.000Z</updated>
        <summary type="html"><![CDATA[什么是Envd?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是envd">什么是Envd?<a class="hash-link" href="#什么是envd" title="Direct link to heading">​</a></h2><blockquote><p>通过编写 Python 代码来负责 Docker 和开发环境的设置，因为开发环境充满了 Dockerfile、bash 脚本、Kubernetes YAML 清单以及许多其他总是会中断的笨重文件。envd构建是隔离和干净的。你可以用 Python 编写简单的指令，而不是 Bash / Makefile / Dockerfile / ...，并且envd提供可重复的构建和可重现的结果。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="研究现状">研究现状<a class="hash-link" href="#研究现状" title="Direct link to heading">​</a></h2><ol><li>当前的研究环境存在conda的使用规范问题（一个环境支持多个模型进行推理和训练）以及研究环境到推理环境的依赖不对等问题（模型训练过程中需要的环境依赖，在推理过程中往往不全是必须的）。</li><li>没有有效的辅助从研究环境到推理环境迁移的工具链,在迁移的过程中，往往需要开发人员自己去安装环境依赖,并对业务代码做出一定的修改，浪费了人力。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="通过envd辅助业务流程构建">通过envd辅助业务流程构建<a class="hash-link" href="#通过envd辅助业务流程构建" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="需要的文件">需要的文件：<a class="hash-link" href="#需要的文件" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- conda yaml环境配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 编写的wrapper.py文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 模型的代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 业务的base镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 通过配置文件编写的build.envd文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="服务构建流程图">服务构建流程图：<a class="hash-link" href="#服务构建流程图" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="img_1.png" src="/athena_website/en/assets/images/prop-1-3644bcacb55ecdb5841779ccf382eb82.jpg" width="2106" height="1021" class="img_ev3q">  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="base镜像的构建方案">base镜像的构建方案<a class="hash-link" href="#base镜像的构建方案" title="Direct link to heading">​</a></h4><ul><li>ubuntu + aiservice + cpu</li><li>ubuntu + aiservice + gpu</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="通过envd实现服务环境迁移案例">通过envd实现服务环境迁移案例<a class="hash-link" href="#通过envd实现服务环境迁移案例" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1requirements">1、Requirements<a class="hash-link" href="#1requirements" title="Direct link to heading">​</a></h4><ul><li>Docker (20.10.0 or above)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2envd-安装">2、envd 安装<a class="hash-link" href="#2envd-安装" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --pre --upgrade envd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">envd bootstrap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3导出-conda-envyaml示例">3、导出 Conda env.yaml示例<a class="hash-link" href="#3导出-conda-envyaml示例" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name: kyle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">channels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://repo.anaconda.com/pkgs/main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dependencies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - pip:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - opencv-python==4.1.2.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prefix: C:\ProgramData\Anaconda3\envs\kyle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4编写buildenvd示例">4、编写build.envd示例<a class="hash-link" href="#4编写buildenvd示例" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def build():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mirror_config() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base(language="python3.8", os="ubuntu20.4")                          # 加载基础镜像并设置conda内置的python版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install.python_packages(name = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "torch==1.10",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "openmim"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install.conda_packages(channel= ["pytorch"], env_file = "env.yaml")   # 指定路径下进行conda yaml环境安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install.python_packages(requirements="build.txt")                     # 指定路径下进行requirments.txt安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install.system_packages(name = [                                      # 系统依赖安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "libgl1-mesa-glx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(commands=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "mim install mmcv-full",                                           # 通过第三方工具mim来进行安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io.copy(src="./detectron2", dest="/")                                  # 本地文件到镜像的拷贝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(commands=[                                                         # 离线进行依赖包安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "pip install -e /detectron2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def mirror_config():                                                       #下载源配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config.pip_index(url = "https://pypi.tuna.tsinghua.edu.cn/simple")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config.conda_channel(channel="""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    channels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    show_channel_urls: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_channels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://repo.anaconda.com/pkgs/main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    custom_channels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5通过envd构建镜像">5、通过envd构建镜像<a class="hash-link" href="#5通过envd构建镜像" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">envd build --t 镜像名:TAG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>sea-wyq</name>
            <uri>https://github.com/sea-wyq</uri>
        </author>
        <category label="envd" term="envd"/>
        <category label="conda" term="conda"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[参与开源的那些事？]]></title>
        <id>git</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/git"/>
        <updated>2022-10-22T11:24:16.000Z</updated>
        <summary type="html"><![CDATA[学完这篇文章，你将会学会如何参与开源项目]]></summary>
        <content type="html"><![CDATA[<p>学完这篇文章，你将会学会如何参与开源项目</p><h1>为什么要参与开源项目？</h1><ul><li>自己的代码被合并是一件有趣的事情。</li><li>在看开源项目的源码的过程中，会收益很多，编码的能力能够在上一个台阶。</li></ul><h1>为什么我想介绍如何PR？</h1><p>在管理一个github项目的过程中三差五就会有新贡献者提交 PR 过来，但是多数贡献者在提交第一个 PR 时往往会遇到一个或多个问题，比如产生冲突、commits 记录过多或者混乱、commit 没有签名、commit message 不规范、各种 ci 流程检查报错等等。  </p><p>那么今天我想尝试彻底讲明白“如何正确地提交一个 PR”，尝试细说 GitHub 上的 PR 全过程，以及这里面可能会遇到的各种困难和解决办法。一方面希望对第一次参与开源项目的新人有所帮助，另一方面希望能够进一步降低我们项目的参与门槛。</p><h1>我想参与开源项目，怎么开始？</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="寻找合适的开源项目">寻找合适的开源项目<a class="hash-link" href="#寻找合适的开源项目" title="Direct link to heading">​</a></h3><p>如果你就只是想开始参与开源，暂时还不知道该参与哪个社区，那么我有几个小建议：</p><ul><li>不要从特别成熟的项目开始。比如现在去参与 Kubernetes 社区，一方面由于贡献者太多，很难抢到一个入门级的 issue 来开始第一个 PR；另外一方面也由于贡献者太多，你的声音会被淹没，社区维护者并不在意多你一个或者少你一个（当然可能没有人会承认，但是你不得不信），如果你提个 PR 都遇到了各种问题还不能自己独立解决，那么很可能你的 PR 会直接超时关闭，没有人在意你是不是有一个好的参与体验；</li><li>不要从特别小的项目开始。这就不需要我解释了吧？很早期的开源项目可能面临着非常多的问题，比如代码不规范、协作流程不规范、重构频繁且不是 issue 驱动的，让外部参与者无所适从……</li><li>选择知名开源软件基金会的孵化项目。这类项目一方面不是特别成熟，所以对新贡献者友好；另一方面也不会特别不成熟，不至于给人很差的参与体验，比如 Apache 基金会、Linux 基金会、CNCF 等。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="寻找贡献点">寻找贡献点<a class="hash-link" href="#寻找贡献点" title="Direct link to heading">​</a></h3><p>开源项目的参与方式很多，最典型的方式是提交一个特性开发或者 bug 修复相关的 PR，但是其实文档完善、测试用例完善、bug 反馈等等也都是非常有价值的贡献。</p><ul><li>在项目 GitHub 代码库首页都会有一个 Issues 入口，这里会记录项目目前已知的 bug、proposal（可以理解成新需求）、计划补充的文档、亟需完善的 UT 等等。</li><li>浏览一下这些issues，看下有没有你感兴趣的而且还没被分配的 issue，然后在下面留言，等待项目管理员分配任务后就可以开始编码了。</li></ul><h1>我要提交PR，怎么上手？</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步fork-项目仓库">第一步：Fork 项目仓库<a class="hash-link" href="#第一步fork-项目仓库" title="Direct link to heading">​</a></h3><p>GitHub 上的项目都有一个 Fork 按钮，我们需要先将开源项目 fork 到自己的账号下，以aiges为例：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/fork-840a3d5884d6fe4a478edf8ca2b5f681.png" width="1915" height="757" class="img_ev3q">
点一下 Fork 按钮，然后回到自己账号下，可以找到 fork 到的项目了：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/fork2-4f5c5d6be16b3cb24426cc8942397ec8.png" width="1918" height="799" class="img_ev3q">
这个项目在你自己的账号下，也就意味着你有任意修改的权限了。我们后面要做的事情，就是将代码变更提到自己 fork 出来的代码库里，然后再通过 Pull Request 的方式将 commits 合入上游项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步克隆项目仓库到本地">第二步：克隆项目仓库到本地<a class="hash-link" href="#第二步克隆项目仓库到本地" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/sea-wyq/aiges.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> aiges </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> upstream https://github.com/iflytek/aiges.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你配置好了 ssh 方式来 clone 代码，当然，git clone 命令用的 url 可以改成：<a href="mailto:git@github.com" target="_blank" rel="noopener noreferrer">git@github.com</a>:iflytek/aiges.git。</p><p>完成这一步后，我们在本地看到的 remote 信息应该是这样的：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">origin https://github.com/sea-wyq/aiges.git </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fetch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">origin https://github.com/sea-wyq/aiges.git </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">push</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream https://github.com/iflytek/aiges.git </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fetch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream https://github.com/iflytek/aiges.git </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">push</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>记住啰，你本地的代码变更永远只提交到 origin，然后通过 origin 提交 Pull Request 到 upstream。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第三步更新本地分支代码">第三步：更新本地分支代码<a class="hash-link" href="#第三步更新本地分支代码" title="Direct link to heading">​</a></h3><p>如果你刚刚完成 fork 和 clone 操作，那么你本地的代码肯定是新的。但是“刚刚”只存在一次，接着每一次准备开始写代码之前，你都需要确认本地分支的代码是新的，因为基于老代码开发你会陷入无限的冲突困境之中。</p><p>更新本地 main 分支代码：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git fetch upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git checkout main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git rebase upstream/main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，我不建议你直接在 main 分支写代码，虽然你的第一个 PR 从 main 提交完全没有问题，但是如果你需要同时提交 2 个 PR 呢？总之鼓励新增一个 feat-xxx 或者 fix-xxx 等更可读的分支来完成开发工作。</p><p>创建分支：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout -b feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，我们就得到了一个和上游 main 分支代码一样的特性分支 feat-xxx 了，接着可以开始愉快地写代码啦！</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第四步写代码">第四步：写代码<a class="hash-link" href="#第四步写代码" title="Direct link to heading">​</a></h3><p>没啥好说的，写就是了，写！</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第五步commit-和-push">第五步：Commit 和 Push<a class="hash-link" href="#第五步commit-和-push" title="Direct link to heading">​</a></h3><p>通用的流程：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit -s -m </span><span class="token string" style="color:#e3116c">"some description here"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin branchName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，这里大家需要理解这几个命令和参数的含义，灵活调整。比如你也可以用 git add --all 完成 add 步骤，在 push 的时候也可以加 -f 参数，用来强制覆盖远程分支（假如已经存在，但是 commits 记录不合你意）。但是请记得 git commit 的 -s 参数一定要加哦！</p><p>这里要注意 commit message 的规范，可能每个开源项目的要求不尽相同，比如 DevStream 的规范<!-- -->[6]<!-- -->是类似这样的格式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">optional scope</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">description</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">optional body</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">optional footer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>举几个例子：</p><ul><li>feat: some description here</li><li>docs: some description here</li><li>fix: some description here</li><li>fix(core): some description here</li><li>chore: some description here</li><li>……</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第六步开一个-pr">第六步：开一个 PR<a class="hash-link" href="#第六步开一个-pr" title="Direct link to heading">​</a></h3><p>在完成 push 操作后，我们打开 GitHub，可以看到显示一个超前提交信息，告诉我们可以开一个 Pull Request 了：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/pull-422a6e3495843ddc38ef9645f3c519ee.png" width="1918" height="613" class="img_ev3q"></p><p>点击Pull Request 格式默认是这样的：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/pull2-9b7d94f82530bf761f5844452ae946e6.png" width="1890" height="964" class="img_ev3q"></p><p>这里我们需要填写一个合适的标题（默认和 commit message 一样），然后按照模板填写 PR 描述。PR 模板其实在每个开源项目里都不太一样，我们需要仔细阅读上面的内容，避免犯低级错误。</p><p>填写完毕后，然后点击右下角 “Create pull request” 就完成了一个 PR 的创建了。</p><p>提交了 PR 之后，我们就可以在 PR 列表里找到自己的 PR 了，这时候还需要注意 ci 检查是不是全部能够通过，假如失败了，需要及时修复。
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/pull3-cafbbfd207906fcb4b391257db632fa3.png" width="1909" height="906" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第七步pr-合入">第七步：PR 合入<a class="hash-link" href="#第七步pr-合入" title="Direct link to heading">​</a></h3><p>如果你的 PR 很完美，毫无争议，那么过不了太长时间，项目管理员会直接合入你的 PR，那么你这个 PR 的生命周期也就到此结束了。</p><p>但是，没错，这里有个“但是”，但是往往第一次 PR 不会那么顺利，我们接下来就详细介绍一下可能经常遇到的一些问题和对应的解决办法。</p><h1>我提交了一个 PR，然后遇到了其他问题</h1><p>多数情况下，提交一个 PR 后是不会被马上合入的，reviewers 可能会提出各种修改意见，或者我们的 PR 本身存在一些规范性问题，或者 ci 检查就直接报错了，怎么解决呢？继续往下看吧。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reviewers-提了一些修改意见我如何更新-pr">Reviewers 提了一些修改意见，我如何更新 PR？<a class="hash-link" href="#reviewers-提了一些修改意见我如何更新-pr" title="Direct link to heading">​</a></h3><p>很多时候，我们提交了一个 PR 后，还需要继续追加 commit，比如提交后发现代码还有点问题，想再改改，或者 reviewers 提了一些修改意见，我们需要更新代码。</p><p>一般我们遵守一个约定：在 review 开始之前，更新代码尽量不引入新的 commits 记录，也就是能合并就合并，保证 commits 记录清晰且有意义；在 review 开始之后，针对 reviewers 的修改意见所产生的新 commit，可以不向前合并，这样能够让二次 review 工作更有针对性。</p><p>不过不同社区要求不一样，可能有的开源项目会要求一个 PR 里只能包含一个 commit，大家根据实际场景灵活判断即可。</p><p>说回如何更新 PR，我们只需要在本地继续修改代码，然后通过和第一个 commit 一样的步骤，执行这几个命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit -s -m </span><span class="token string" style="color:#e3116c">"some description here"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候别看 push 的是 origin 的 feat-xxx 分支，其实 GitHub 会帮你把新增的 commits 全部追加到一个未合入 PR 里去。没错，你只管不断 push，PR 会自动更新。</p><p>至于如何合并 commits，我们下一小节具体介绍。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commits-太多或者记录混乱如何合并-commits">Commits 太多或者记录混乱，如何合并 Commits？<a class="hash-link" href="#commits-太多或者记录混乱如何合并-commits" title="Direct link to heading">​</a></h3><p>很多情况下我们需要去合并 commits，比如你的第一个 commit 里改了100 行代码，然后发现少改了 1 行，这时候又提交了一个 commit，那么第二个 commit 就太“没意思”了，我们需要合并一下。
比如我这里有2个同名的 commits，第二个 commit 其实只改了一个标点：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/rebase-f6bf5b93af7e89e8c593b993dea293a9.png" width="1080" height="574" class="img_ev3q">
这时候我们可以通过 rebase 命令来完成2个 commits 的合并：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> rebase -i HEAD~2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行这个命令会进入一个编辑页面，默认是 vim 编辑模式，内容大致如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick 3114c0f docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick 9b7d63b docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rebase d640931..9b7d63b onto d640931 (2 commands)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Commands:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># p, pick = use commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># r, reword = use commit, but edit the commit message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># e, edit = use commit, but stop for amending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># s, squash = use commit, but meld into previous commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># f, fixup = like "squash", but discard this commit's log message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># x, exec = run command (the rest of the line) using shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># d, drop = remove commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># These lines can be re-ordered; they are executed from top to bottom.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If you remove a line here THAT COMMIT WILL BE LOST.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># However, if you remove everything, the rebase will be aborted.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要把第二个 pick 改成 s，然后保存退出（vim 的 wq 命令）：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick 3114c0f docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s 9b7d63b docs: just fortest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接着会进入第二个编辑页面：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This is a combination of 2 commits.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This is the 1st commit message:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signed-off-by: Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This is the commit message #2:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signed-off-by: Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Please enter the commit message for your changes. Lines starting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># with '#' will be ignored, and an empty message aborts the commit.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里是用来编辑合并后的 commit message 的，我们直接删掉多余部分，只保留这样几行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signed-off-by: Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接着同样是 vim 的保存退出操作，这时候可以看到日志：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">detached HEAD 80f5e57</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> docs: just fortest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Date: Wed Jul </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:28:37 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> changed, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> insertions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully rebased and updated refs/heads/feat-1.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候可以通过git log命令查看下 commits 记录是不是符合预期：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/rebase2-f448fc0617b3ad602494ad4527bcb0d9.png" width="1080" height="629" class="img_ev3q"></p><p>好，我们在本地确认 commits 已经完成合并，这时候就可以继续推送到远程，让 PR 也更新掉：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -f origin feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里需要有一个-f参数来强制更新，合并了 commits 本质也是一种冲突，需要冲掉远程旧的 commits 记录。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pr-产生了冲突如何解决">PR 产生了冲突，如何解决？<a class="hash-link" href="#pr-产生了冲突如何解决" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="在线解决冲突">在线解决冲突<a class="hash-link" href="#在线解决冲突" title="Direct link to heading">​</a></h4><p>我们要尽可能避免冲突，养成每次写代码前更新本地代码的习惯。不过，冲突不可能完全避免，有时候你的 PR 被阻塞了几天，可能别人改了同一行代码，还抢先被合入了，这时候你的 PR 就出现冲突了，类似这样（同样，此刻我不能真的去上游项目构造冲突，所以下面用于演示的冲突在我在自己的 repo 里）：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict-bc5ddff5bb2cf651201fb205487099fb.png" width="1080" height="359" class="img_ev3q">
每次看到这个页面都会让人觉得心头一紧。我们点击 “Resolve conflicts” 按钮，就可以看到具体冲突的内容了：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict1-63dfe7387ea3599ab6a404aeb5f7525d.png" width="656" height="326" class="img_ev3q">
可以看到具体冲突的行了，接下来要做的就是解决冲突。我们需要删掉所有的 &lt;&lt;&lt;&lt;&lt;&lt;&lt;、&gt;&gt;&gt;&gt;&gt;&gt;&gt; 和 ======= 标记，只保留最终想要的内容，如下：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict2-2fe290f5ed3046778bdd3146ca93a644.png" width="572" height="258" class="img_ev3q">
接着点击右上角的“Mark as Resolved”：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict3-e3e8423f3e00e065a61815f201a0a892.png" width="1052" height="528" class="img_ev3q">
最后点击“Commit merge”：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict4-3d66027b7fc8f6db33978b6fd654a5a6.png" width="1080" height="362" class="img_ev3q">
这样就完成冲突解决了，可以看到产生了一个新的 commit：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict5-d84e3e94586a315f7537172a88afcee1.png" width="1080" height="248" class="img_ev3q">
到这里，冲突就解决掉了。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="本地解决冲突">本地解决冲突<a class="hash-link" href="#本地解决冲突" title="Direct link to heading">​</a></h4><p>更多时候，我们需要在本地解决冲突，尤其是冲突太多，太复杂的时候。</p><p>同样，我们构造一个冲突，这次尝试在本地解决冲突。</p><p>先在线看一下冲突的内容：
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/conflict1-63dfe7387ea3599ab6a404aeb5f7525d.png" width="656" height="326" class="img_ev3q"></p><p>接着我们在本地执行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 先切回到 main 分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 拉取上游代码（实际场景肯定是和上游冲突，我们这里的演示环境其实是 origin）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> fetch upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 更新本地 main（这里也可以用 rebase，但是 reset 不管有没有冲突总是会成功）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset --hard upstream/main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到这里，本地 main 分支就和远程（或者上游）main 分支代码完全一致了，然后我们要做的是将 main 分支的代码合入自己的特性分支，同时解决冲突。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout feat-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> rebase main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候会看到这样的日志：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">First, rewinding </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> to replay your work on </span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> of it</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Applying: docs: conflict </span><span class="token builtin class-name">test</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using index info to reconstruct a base tree</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">M       README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Falling back to patching base and </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">-way merge</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Auto-merging README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFLICT </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Merge conflict </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error: Failed to merge </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the changes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Patch failed at 0001 docs: conflict </span><span class="token builtin class-name">test</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The copy of the patch that failed is found in: .git/rebase-apply/patch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolve all conflicts manually, mark them as resolved with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"git add/rm &lt;conflicted_files&gt;"</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> run </span><span class="token string" style="color:#e3116c">"git rebase --continue"</span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can instead skip this commit: run </span><span class="token string" style="color:#e3116c">"git rebase --skip"</span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To abort and get back to the state before </span><span class="token string" style="color:#e3116c">"git rebase"</span><span class="token plain">, run </span><span class="token string" style="color:#e3116c">"git rebase --abort"</span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要解决冲突，直接打开 README.md，找到冲突的地方，直接修改。这里的改法和上一小节介绍的在线解决冲突没有任何区别，我就不赘述了。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -f origin feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候我们再回到 GitHub 看 PR 的话，可以发现冲突已经解决了，并且没有产生多余的 commit 记录，也就是说这个 PR 的 commit 记录非常干净，好似冲突从来没有出现过：</p><p>至于什么时候可以在线解决冲突，什么时候适合本地解决冲突，就看大家如何看待“需不需要保留解决冲突的记录”了，不同社区的理解不一样，可能特别成熟的开源社区会希望使用本地解决冲突方式，因为在线解决冲突产生的这条 merge 记录其实“没营养”。至于 DevStream 社区和 DevLake 社区，我们推荐使用后一种，但是不做强制要求。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ci-检查不过commit-message-相关问题如何修复">CI 检查不过：commit message 相关问题如何修复？<a class="hash-link" href="#ci-检查不过commit-message-相关问题如何修复" title="Direct link to heading">​</a></h4><p>前面我们提到过 commit message 的规范，但是第一次提交 PR 的时候还是很容易出错，比如 feat: xxx 其实能通过 ci 检查，但是 feat: Xxx 就不行了。假设现在我们不小心提交了一个 PR，但是里面 commit 的 message 不规范，这时候怎么修改呢？</p><p>太简单了，直接执行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit --amend</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这条命令执行后就能进入编辑页面，随意更新 commit message 了。改完之后，继续 push：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -f origin feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样就能更新 PR 里的 commit message 了。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ci-检查不过dcosign-问题如何修复">CI 检查不过：DCO(sign) 问题如何修复？<a class="hash-link" href="#ci-检查不过dcosign-问题如何修复" title="Direct link to heading">​</a></h4><p>相当多的开源项目会要求所有合入的 commits 都包含一行类似这样的记录：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以 commit message 看起来会像这样：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">feat: some description here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signed-off-by: Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这行信息相当于是对应 commit 的作者签名。要添加这样一行签名当然很简单，我们直接在 git commit 命令后面加一个 -s 参数就可以了，比如 git commit -s -m "some description here" 提交的 commit 就会带上你的签名。</p><p>但是如果如果你第一次提交的 PR 里忘记了在 commits 中添加 Signed-off-by 呢？这时候，如果对应开源项目配置了 DCO 检查<!-- -->[8]<!-- -->，那么你的 PR 就会在 ci 检查中被“揪出来”没有正确签名。</p><p>我们看下如何解决：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit --amend -s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样一个简单的命令，就能直接在最近一个 commit 里加上 Signed-off-by 信息。执行这行命令后会直接进入 commit message 编辑页面，默认如下图：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docs: dco </span><span class="token builtin class-name">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Signed-off-by: Daniel Hu </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tao.hu@merico.dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候我们可以同时修改 commit message，如果不需要，那就直接保存退出好了，签名信息是会自动加上的。</p><p>完成签名后呢？当然是来一个强制 push 了：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git push -f origin feat-xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，你 PR 中的 DCO 报错就自然修复了。</p><p>本文引用自：<a href="https://mp.weixin.qq.com/s/sP2dC0txvBhExYxbjq94UA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/sP2dC0txvBhExYxbjq94UA</a></p>]]></content>
        <author>
            <name>sea-wyq</name>
            <uri>https://github.com/sea-wyq</uri>
        </author>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[集成三方API实现Python加载器插件]]></title>
        <id>music/api</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/music/api"/>
        <updated>2022-10-22T11:24:16.000Z</updated>
        <summary type="html"><![CDATA[集成三方API实现Python加载器插件]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="集成三方api实现python加载器插件">集成三方API实现Python加载器插件<a class="hash-link" href="#集成三方api实现python加载器插件" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="能力">能力<a class="hash-link" href="#能力" title="Direct link to heading">​</a></h3><p>AI能力是指已完成云服务化的AI引擎。部署完成后，能力的使用者可以直接通过API和生成的接口文档进行集成及调用。具体定义可以参考<a href="https://www.iflyaicloud.com/aipaas-doc/docs/01-%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D/02-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A.html" target="_blank" rel="noopener noreferrer">ASE引擎名词解释</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载器插件">加载器插件<a class="hash-link" href="#加载器插件" title="Direct link to heading">​</a></h3><p>能力是通过加载器插件来调用。调用的能力不仅包含AI能力的使用，普通网络请求的调用同样适用。</p><p>对于非流式的网络请求——HTTP请求——来说，插件的主体包括四步；加载器的初始化；加载器的完成；加载器的执行；加载器的错误处理。分别对应了四个执行函数<code>wrapperInit</code>；<code>wrapperFini</code>；<code>wrapperOnceExec</code>；<code>wrapperError</code>。</p><p>通常加载器插件实现采用了C++语言，对于熟谙C++语言的用户来说毫无压力，当了解加载器插件的运行流程、数据输入和输出方式后，就可以实现自己的加载器插件，随即通过编译成<strong>动态库文件</strong>后可调用。</p><p>Python是一种弱类型语音，相比于C++，Python更小巧精悍，用户也能够更容易上手构建加载器插件。</p><p><strong>本例主要介绍了一个调用<a href="https://docs.acrcloud.cn/api-reference/identification-api" target="_blank" rel="noopener noreferrer">三方音乐识别API</a>的Python加载器插件实现步骤。调用音乐识别API时用户会发送待识别音乐的二进制流数据，音乐格式支持mp3、wav、wma、amr、ogg、ape、acc、spx、m4a、mp4、FLAC等，返回的识别结果是JSON对象。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实现加载器插件">实现加载器插件<a class="hash-link" href="#实现加载器插件" title="Direct link to heading">​</a></h3><p><strong>加载器插件初始化函数</strong><code>wrapperInit</code>用于初始化加载器执行过程中用到的变量，这些参数从配置文件<code>config</code>中读入，其中<strong>requrl</strong>是发送请求的地址。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> requrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> http_method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> http_uri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> access_key_music</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> access_secret_music</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> access_key_humming</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> access_secret_humming</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> http_method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> http_uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'requrl'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'http_method'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'http_uri'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">access_key_music</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> access_secret_music </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_key_music'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_secret_music'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">access_key_humming</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> access_secret_humming </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_key_humming'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_secret_humming'</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>加载器插件执行函数</strong><code>wrapperOnceExec</code>的执行由<strong>鉴权</strong>、<strong>发送HTTP请求</strong>和<strong>接收响应数据</strong>构成。</p><ul><li><p>鉴权的签名是通过<code>http_method</code>、<code>http_uri</code>、<code>access_key</code>、<code>data_type</code>、<code>signature_version</code>以及<code>时间戳</code>等来构建，构建过程如下：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">signature_version</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'audio'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string_to_sign </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http_method </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> http_uri </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> access_key </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> data_type </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> signature_version </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sign </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hmac</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">access_secret</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ascii'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> string_to_sign</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ascii'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                digestmod</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ascii'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> sign </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'HMAC failure.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5014</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>HTTP请求体可以看作一个字典，包括了<code>请求数据</code>、<code>access_key</code>、<code>数据的长度</code>、<code>时间戳</code>、<code>签名</code>、<code>data_type</code>和<code>signature_version</code>等。</p><p>  构建的HTTP请求体如下：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'sample'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'access_key'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> access_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'sample_bytes'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sample_bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'timestamp'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'signature'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sign</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'data_type'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'signature_version'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> signature_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>此外，在执行的过程中，错误需要<strong>尽可能早</strong>捕获，错误码也要和第三方平台区别开来，即使是默认的HTTP错误码也要有辨别也好，方便定位错误。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exceptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConnectTimeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Http post timeout.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4408</span><span class="token comment" style="color:#999988;font-style:italic"># http timeout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> r </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"HTTP内容非法"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status_code</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>请求的响应数据是JSON格式，有三个字段：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">"cost_time"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">"status"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">"metadata"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  其中<code>status</code>字段中的<code>code</code>代表了响应的状态，为0表示请求成功，否则失败。所以应该判断<code>code</code>的取值，当不为零时则提前返回<code>code</code>表示的错误码</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pattern </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'"code":\d+'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">findall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> error_code</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">':'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error_code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error_code</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  响应成功则返回一个预先定义好的字典表示：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encoding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">respData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'key'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'output_text'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'type'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'status'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"data"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"len"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><strong>加载器插件错误处理函数</strong><code>wrapperError</code>将会返回错误码代表的含义，在本例中如下</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1001</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"识别无结果"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"录音失败，可能是设备权限问题"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2001</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"初始化错误或者初始化超时"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2002</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"处理metadata错误"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2004</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"无法生成指纹（有可能是静音）"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2005</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"超时"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"服务端错误"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Access Key不存在或错误"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3002</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"HTTP内容非法"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3003</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"请求数超出限制（需要升级账号）"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3006</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"参数非法"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3014</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"签名非法"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3015</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"QPS超出限制（需要升级账号）"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"User Defined Error: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">ret</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>加载器插件完成函数</strong><code>wrapperFini</code>用于处理一些加载器的收尾工作，在C++语言中里面会执行一些堆区和指针的释放，对于Python语言，通常不需要实现：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrapperFini</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Wrapper finished.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>以上就是一个调用三方API的Python加载器实现的简单介绍</strong>
具体代码可以参考<a href="https://github.com/xfyun/aiges/tree/master/demo/music_api" target="_blank" rel="noopener noreferrer">集成三方API实现Python加载器插件</a></p>]]></content>
        <author>
            <name>jhr</name>
            <uri>https://github.com/robbinlol</uri>
        </author>
        <category label="三方API" term="三方API"/>
        <category label="Python加载器插件" term="Python加载器插件"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[讯飞开源指导]]></title>
        <id>opensource-guide</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/opensource-guide"/>
        <updated>2022-08-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[随着近几年开源的蓬勃发展，开源的影响力在业内也是广泛被认可。以BAT为首的各行业的企业都在开源领域内发展其一些关键技术;一些关键的商业化场景更是以公司的开源实力来量化招标要求；]]></summary>
        <content type="html"><![CDATA[<p>随着近几年开源的蓬勃发展，开源的影响力在业内也是广泛被认可。以BAT为首的各行业的企业都在开源领域内发展其一些关键技术;一些关键的商业化场景更是以公司的开源实力来量化招标要求；</p><p>我司在几年前已经开展了一些开源的工作，也收集到集团内部一些零星的力量参与了开源社区的工作信息，总而言之，集团层面的开源工作没有形成有效的合力。</p><p>为此:</p><p>3月初，<strong>我们</strong>重新拾起了在几年前就已在Github开放代码的AthenaServing推理服务框架</p><p>6月，我们积极推进，最终集团正式成立了<a href="mailto:ifly_ospo@iflytek.com" target="_blank" rel="noopener noreferrer">集团的开源工作组</a></p><p>7月25日，我们开展了第一次开源分享会，分享会上，我们对内宣发了开源工作成立的消息，同时，我们邀请了2位开源大咖给讯飞er们分享了一些非常有用的心路历程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内部参与开源">内部参与开源?<a class="hash-link" href="#内部参与开源" title="Direct link to heading">​</a></h2><p>在集团内部，我们定义了一套基础的开源工作流</p><p><img loading="lazy" src="https://www.plantuml.com/plantuml/png/VLBDRjD06BpxAVQON2e1jmILSkB2WGVWuYRRU8LPL_PM5JT7RR3D3tPKKbMfAzKghIn-J42bj4bA7WRlP_l4As1dqyf83f8bM_FDUBwTdJM3oJhRUgvAymz98XkezeWmPMkT__mElfC5LybXzA2Ec88fght0Hbr2g25WU7NAFrZD0W3Ru_s398XuD9m3ZqaBKmFV85WrCAfHhL0N7lnbBzi9btlaj0eRX7IyYMM66l7a93dkBluI1N1ysHIQTRdrR5lMspSK69p3-oiXfXh3I2STXJNG_PQcQdf3n-tLTFSR3Dm_qpSySdWl1ESJk6xonIaRRYj4nQXMKWdNp1ocColVdHZ_JhspUk5t2tPqZEag77ojYwCbZWt-P-xs-UNERxCBX-UmFohMB2TL4K55rXLfqpRPa1QlV2nkD9xiyV5UKreQn9qLGHIU-SEl1n06S3I3Ts4yUOsUqhiB2dhOOaIZMUzjSXtTJk-j22diMn2S2EOJkOFBj68VtW_ZwH3yCRSlvcr9hO_fp4kzq_ziLwwCI4-4nkqHdvemzaIOyQ-ZPFSYyytqh9l-68aMYClAIwvjIcjvB7dZ_m80" alt="img" class="img_ev3q"></p><p><strong><em>项目报备阶段</em></strong>
其中项目报备阶段有如下细分流程:</p><p><img loading="lazy" src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuG8pk1GKh5uktFbyzhhdKpO_wrfg3HJ8ooz9LIZAJCyeiLAmISxFoI-oAafDiLDusZ_nPTEw9xktFPenpoOpBQSoFh-u8Dy1n2f9pTPBpi-r0-fMA4ejI4qiWHdxTDt25ylRh1MuG58AIOd9sUM9HIaALiyw9p-TFGza7JuBrp_PqVTqJyEpNHEURb_wPE-SvxjRddLCU3fnnhDDyrysp08gUD4uvVdctGesbKcLYNdfvYYkqR41YILdfEOPcQAw4k7CyepCd5G53IHh8Iu6clvYVxkzfa9cCQhiX6MQ80V31TEBKbFpx9xDMAy92altp9ACqgGdkoS_tJNvsTpcbpCd0CFrnVhjm030wKq2lk020eVKl1HWd040" alt="img" class="img_ev3q"></p><p>有意向开源需要向<a href="mailto:ifly_ospo@iflytek.com" target="_blank" rel="noopener noreferrer">开源工作组</a>提供如下信息:</p><ol><li>明确项目主要负责人</li><li>向开源工作组报备计划开源内容: 项目名称、动机、目标，阵地等</li><li>提供项目大致内容以及RoadMap介绍，价值分析等</li><li>得对应部门领导许可</li></ol><p>此外，对开源有任何疑问的同学，也可以发邮件至<a href="mailto:ifly_ospo@iflytek.com" target="_blank" rel="noopener noreferrer">开源工作组</a></p><p><strong><em>项目代码内部评审</em></strong></p><ol><li><p>负责人先在内部评估计划开源代码开源范围，即功能清单(此举为保护部分非常商业化领域核心代码)</p></li><li><p>脱敏、并发起内部代码评审</p></li></ol><p>评审定目标产物:</p><ol><li><p>是否可开源</p></li><li><p>开源功能清单</p></li></ol><p><strong>注意: 代码评审会由项目负责人发起，最终提供给开源工作组结论即可。</strong></p><p><strong><em>项目代码成员确定</em></strong></p><ol><li><p>确定内部参与人员，以及角色分配</p></li><li><p>外部成员根据项目负责人邀请自行认定，但必须保证经过一系列有效代码提交。外部优秀开发者，可根据提交数量、质量向工作组推荐邀请进入Github 讯飞开源组织。 (此工作流待完善)</p></li></ol><p><strong><em>版本发布、更新</em></strong></p><ol><li>开源的项目版本发布、更新策略由项目负责人自行控制</li><li>由内部项目演化而来的开源项目更新时，亦需要经过内部代码审核确保功能清单合规</li></ol><p><strong><em>Github仓库</em></strong></p><p>集团统一开源组织为<a href="https://github.com/iflytek" target="_blank" rel="noopener noreferrer">iflytek</a>， 当前组织管理员为 <a href="mailto:ybyang7@iflytek.com" target="_blank" rel="noopener noreferrer">ybyang7</a></p><p>原则上，后续以公司名义开源的新项目需要统一在此组织下维护。</p><p><strong><em>Github Member权限申请</em></strong></p><p>Github iflytek组织Member的权限申请，可以发邮件至<a href="mailto:ifly_ospo@iflytek.com" target="_blank" rel="noopener noreferrer">ifly_ospo</a> </p><p><strong><em>此流程为内部员工流程， 外部开发者进入组织权限将以github workflow形式自动化加入</em></strong></p><p>邮件内容需提供:</p><ol><li>已开源、或者计划开源项目信息</li><li>域账号以及github账户名</li><li>个人职位角色以及部门信息</li></ol><p><strong><em>Github项目目录</em></strong></p><p>不同语言有不同的目录结构，除了基础的代码部分，项目目录推荐提供如下文件:</p><ol><li><p><a href="https://github.com/iflytek/opensource_templates/blob/master/README.md" target="_blank" rel="noopener noreferrer">Readme.md</a></p></li><li><p><a href="https://github.com/iflytek/opensource_templates/blob/master/LICENSE" target="_blank" rel="noopener noreferrer">LICENSE文件</a>: 一般推介(Apache2.0License)</p></li><li><p><code>.github/workflows/build.yml</code>文件: Github Action配置文件，多用于自动构建</p></li><li><p><code>.github/workflows/release.yml</code>文件: Github Action配置文件，多用于自动发布</p></li></ol><p><a href="https://github.com/iflytek/opensource_templates" target="_blank" rel="noopener noreferrer">目录示例</a></p><p>CI页面示例:</p><p><img loading="lazy" alt="ci" src="/athena_website/en/assets/images/ci-7da2a720697d606b10040448cacee0ef.png" width="1886" height="879" class="img_ev3q"></p><p><strong><em>静态文档网站托管配置</em></strong></p><p><img loading="lazy" alt="img" src="/athena_website/en/assets/images/docwebsite-4e7658f185908d1d242dd06cdd595273.png" width="1909" height="852" class="img_ev3q"></p><p>Github提供了非常易用的静态网站托管功能，配合Github的CI工具: <code>Github Action</code>
以及一些三方文档生成工具如: <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">Docusaurus</a>， <a href="https://www.mkdocs.org/" target="_blank" rel="noopener noreferrer">mkdocs</a>，<a href="https://iflytek.github.io/athena_website/" target="_blank" rel="noopener noreferrer">ASF Website</a>就是利用 <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">Docusaurus</a>构建，并托管在github pages上。</p><p><strong><em>周会机制</em></strong></p><p>这里有两个层面周会:</p><p>1: 开源维护者交流周会(内部视角): 是需要定期向集团汇报开源进展的双周会(周期待调整)
集团内部开源项目负责人需要统一加入开源交流群，并定期报告进展。</p><p>2: 项目自身周会机制: 需要项目负责人根据各自项目开源进程自行发起并开展，推荐以公开在线会议方式开展，周期可以不用太频繁</p><p><strong><em>自运营</em></strong></p><p>开源工作组提供集团统一开源阵地以及门户，指导并规范每个开源项目的基础配置，但真正的项目是否能够良性运营取决于项目发起人及其部门对该开源项目的定位和价值分析，并且有一个可观的RoadMap。 开源虽然看起来似乎很简单，但它是一个需要长期投入的事情，同时做好了也是一件对企业影响力，个人影响力有极大加成的事情</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何参与开源-需要学会哪些github操作">如何参与开源? 需要学会哪些Github操作？<a class="hash-link" href="#如何参与开源-需要学会哪些github操作" title="Direct link to heading">​</a></h2><p>请参考 <a href="https://iflytek.github.io/athena_website/en/blog/git" target="_blank" rel="noopener noreferrer">如何从0参与开源项目</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="写在结尾">写在结尾<a class="hash-link" href="#写在结尾" title="Direct link to heading">​</a></h2><p>开源的工作是一个非常Open的工作，虽然很多时候是我们码农抽取自己的非工作时间来参与，我司虽然没有专门的开源岗位，但是开源本身这个事情在业界影响力对于每个开发人员来说也有目共睹。相信有一天，我司会为开源专门设立岗位，这一天需要每位有兴趣参与开源的同事共同努力，这一天一定不会远。 </p><p>万事开头难， 我们在很多领域技术上都有一些起了个大早，却赶了个晚集，很大原因是由于我们没有坚持，另外我们不断的给自己设限，否定自己，我们开源不会成功，没有出路的思想经常萦绕在我们眼帘，找不到开源的出路和思路。</p><p>开源虽难，但未来可期！</p>]]></content>
        <author>
            <name>ybyang7</name>
            <uri>https://github.com/berlinsaint</uri>
        </author>
        <category label="pybind11" term="pybind11"/>
        <category label="ai" term="ai"/>
        <category label="python" term="python"/>
        <category label="athenaserving" term="athenaserving"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Pybind11加速AI极速落地]]></title>
        <id>Pybind11加速AI极速落地</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/Pybind11加速AI极速落地"/>
        <updated>2022-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[还在想如何偷懒，直接复用研究员的Python代码进行在线推理？]]></summary>
        <content type="html"><![CDATA[<p>还在想如何偷懒，直接复用研究员的Python代码进行在线推理？</p><p>还在寻找模型推理RPC-&gt;HTTP方案？</p><p>还在找 C/C++ 调用 Python, Python调用 C/C++技术方案？</p><p>还在找如何提速Python方案？</p><p>....</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="你在找的这里都有">你在找的这里都有<a class="hash-link" href="#你在找的这里都有" title="Direct link to heading">​</a></h2><p>当前算法开发主流语言都是Python语言， 而想要落地成为生产级别服务应用，往往需要用C/C++等高阶语言进行复现并封装成高性能接口。</p><p>但是并非所有的场景都是需要高性能，任何服务接口的高性能的优化都是循序渐进的，目前很多厂商都会选择用Python进行实际推理， 讯飞当前拥有</p><p>一套Golang加载C插件方案，来支持当前讯飞主要的一些AI线上生产级别服务应用。</p><p>为了让用户更快速的接入Python实现的能力， 在当前讯飞AIGES架构基础上，利用Pybind11兼容了支持Python AI能力服务化。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gocc架构">Go/C、C++架构<a class="hash-link" href="#gocc架构" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="img" src="/athena_website/en/assets/images/c++-e23975cb5828840b362d0761a717cf91.png" width="776" height="571" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持wrapperpy-gocpython-架构">支持wrapper.py Go/C/Python 架构<a class="hash-link" href="#支持wrapperpy-gocpython-架构" title="Direct link to heading">​</a></h2><p>Python Language Wrapper:
<img loading="lazy" alt="img" src="/athena_website/en/assets/images/python-535813f7572c5b2cf0895fd36dfe0dcd.png" width="776" height="571" class="img_ev3q"></p><p>讯飞开源出品的 AthenaServing是一个将 Python AI能力(也可以支持C/C++)发布成为HTTP服务的 AI工程框架，详情请参考: <a href="https://github.com/xfyun/aiges" target="_blank" rel="noopener noreferrer">Github</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="c调用python">C调用Python<a class="hash-link" href="#c调用python" title="Direct link to heading">​</a></h2><p>由上述架构可知， 我们需要使用C++调用Python能力(Golang无法直接调用Python,我们技术栈是Golang)。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="python原生方案">Python原生方案<a class="hash-link" href="#python原生方案" title="Direct link to heading">​</a></h3><p>传统的C调用Python，大多数人都会使用原生的Cpython形式去调用Python，我们在<a href="https://github.com/xfyun/aiges_c_python_wrapper/blob/release-v1.0.0/pyCall_common.cpp" target="_blank" rel="noopener noreferrer">第一个版本</a>时也是如此,其复杂度不言而喻，设计到Python的生命周期管理，内存管理，GIL，引用计数，对象转换等等...</p><p>Python 官方提供了 Python/C API，可以实现「用 C 语言编写 Python 库」，先上一段代码感受一下：</p><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static PyObject *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spam_system(PyObject *self, PyObject *args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const char *command;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int sts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!PyArg_ParseTuple(args, "s", &amp;command))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sts = system(command);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return PyLong_FromLong(sts);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述是一个简单的对python system命令进行调用，却要进行多次手动类型转换，十分痛苦。。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cython方案">Cython方案<a class="hash-link" href="#cython方案" title="Direct link to heading">​</a></h3><p>Cython 主要打通的是 Python 和 C，方便为 Python 编写 C 扩展。Cython 的编译器支持转化 Python 代码为 C 代码，这些 C 代码可以调用 Python/C 的 API。从本质上来说，Cython 就是包含 C 数据类型的 Python。目前 Python 的 numpy，以及腾讯的 tRPC-Python 框架有所应用。</p><p>缺点：
需要手动植入 Cython 自带语法（cdef 等），移植和复用成本高
需要增加其他文件，如 setup.py、*.pyx 来让你的 Python 代码最后能够转成性能较高的 C 代码
对于 C++的支持程度存疑</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swig">SWIG<a class="hash-link" href="#swig" title="Direct link to heading">​</a></h3><p>SWIG 主要解决其他高级语言与 C 和 C++语言交互的问题，支持十几种编程语言，包括常见的 java、C#、javascript、Python 等。使用时需要用*.i 文件定义接口，然后用工具生成跨语言交互代码。但由于支持的语言众多，因此在 Python 端性能表现不是太好。</p><p>值得一提的是，TensorFlow 早期也是使用 SWIG 来封装 Python 接口，正式由于 SIWG 存在性能不够好、构建复杂、绑定代码晦涩难读等问题，TensorFlow 已于 2019 年将 SIWG 切换为 <a href="#PYBIND11">pybind11</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pybind11">PYBIND11<a class="hash-link" href="#pybind11" title="Direct link to heading">​</a></h3><p>在pybind11 之前其实有一个boost.python库也是经典，但是它比较重度依赖 boost周边依赖库，比较庞大，经常让人望而却步.</p><p>pybind11 可以理解为boost.python的精简版，通过提供头文件，宏定义和元编程来简化 Python 的 API 调用。对 C++支持非常好，基于 C++11 应用了各种新特性，也许 pybind11 的后缀 11 就是出于这个原因。</p><p>特点：</p><ul><li>轻量且功能单一，聚焦于提供 C++ &amp; Python binding，交互代码简洁</li><li>对常见的 C++数据类型如 STL、Python 库如 numpy 等兼容很好，无人工转换成本</li><li>only header 方式，无需额外代码生成，编译期即可完成绑定关系建立，减小 binary 大小</li><li>支持 C++新特性，对 C++的重载、继承，debug 方式便捷易用</li><li>完善的官方<a href="https://pybind11.readthedocs.io/" target="_blank" rel="noopener noreferrer">文档</a>支持，应用于多个知名开源项目</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="c与python共舞c-python互调用">C++与python共舞，c++ python互调用<a class="hash-link" href="#c与python共舞c-python互调用" title="Direct link to heading">​</a></h2><ul><li>AIGes中C++结合Pybind11调用Python </li></ul><p>如<a href="#%E6%94%AF%E6%8C%81wrapperpy-gocpython-%E6%9E%B6%E6%9E%84">上述</a>所示,我们为用户设计了class Wrapper类，用户需要实现Wrapper类中的必要方法，然后由C++读取该类并加载对应方法，当用户请求到达时，执行对应python方法，并返回得到相应数据完成一次推理请求。</p><ul><li>C中传入数据到 wrapperOnceExec,python如何接受？</li></ul><p>我们重点看下 <code>Wrapper</code> 类的关键推理方法 <code>wrapperOnceExec</code> 方法, 该方
法函数定义为:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrapperOnceExec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reqData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DataListCls</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Response</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 <code>params</code> 为该请求中的params请求参数映射，是一个字典，主要用于传递用户一些请求控制字段。</p><p> <code>reqData</code> 为该次请求的一些数据段，比如上传一个二进制图像，音频，文本等(此类参数不适合放入params中)，reqData我们要求它必须是1个<code>DataListCls</code>类. 这个类有些特殊，因为我们的数据是来源于 C++,即从C++中传入数据到Python，因此这个请求必须在 c++侧构造，那么此处就涉及到 C++数据和Python数据的转换问题。</p><p> Pybind11提供了在C中定义内嵌(embed)python模块方式: 因此我们可以在C中给python很容易定义一个数据结构，比如此处:</p><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class DataListNode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::string key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::bytes data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int len;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::bytes get_data();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DataListCls {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector &lt;DataListNode&gt; list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataListNode *get(std::string key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataListNode *DataListCls::get(std::string key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int idx = 0; idx &lt; list.size(); idx++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataListNode *node = &amp;list[idx];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (strcmp(node-&gt;key.c_str(), key.c_str()) == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在c++中定义了两个类结构， 一个是 <code>DataListCls</code> 另一个是 <code>DataListNode</code>, 后者是前者的 <code>list</code> 变量成员。
我们的请求数据可以用 <code>DataListCls</code> 表示，那么该类数据传递到python函数如何被执行？</p><p>根据pybind11手册， 我们需要为上述2个类编写binding代码，如下:</p><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_EMBEDDED_MODULE(aiges_embed, module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;DataListNode&gt; dataListNode(module, "DataListNode");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataListNode.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def_readwrite("key", &amp;DataListNode::key, py::return_value_policy::automatic_reference)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def_readwrite("data", &amp;DataListNode::data, py::return_value_policy::automatic_reference)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def_readwrite("len", &amp;DataListNode::len, py::return_value_policy::automatic_reference)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def_readwrite("type", &amp;DataListNode::type, py::return_value_policy::automatic_reference)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def("get_data", &amp;DataListNode::get_data, py::return_value_policy::reference);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;DataListCls&gt; dataListCls(module, "DataListCls");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataListCls.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def_readwrite("list", &amp;DataListCls::list, py::return_value_policy::automatic_reference)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .def("get", &amp;DataListCls::get, py::return_value_policy::reference);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>PYBIND11_EMBEDDED_MODULE</code>(aiges_embed, module) 宏用于定义一个 python的 aiges_embed模块，其内容为两个类的各个成员做了一个与python对应类的绑定动作：</p><p>其中使用 <code>def_readwrite</code>绑定可读写属性，使其与对应C类中成员变量。</p><p>其中使用 <code>def</code>绑定类方法，使其与对应C类中方法(有点类似于用c实现一套方法供用户在python中调用)，上述 wrapperOnceExec方法在c++侧调用后， 执行到 python代码时， 如果执行 reqData.get方法，即会调用c++实现的get方法。</p><p>因为C++和python有不同的内存管理机制， 在为返回非普通类型的函数创建绑定时，这可能会导致问题。仅通过查看类型信息， Python侧不知道是否应该负责返回值并最终释放其资源，或者是否应该在 C++ 端处理内存的释放。为此，pybind11 提供了几个返回值策略 注解，可以传递给module<em>::def()and class</em>::def()函数。默认策略是
<code>return_value_policy::automatic</code>。</p><p>这块在绑定function时需要特别注意， 不合适的返回值策略可能会引发未知错误，因此此部分非常极其重要。</p><p>关于返回值策略，请参考<a href="https://pybind11.readthedocs.io/en/stable/advanced/functions.html" target="_blank" rel="noopener noreferrer">文档</a></p><p>有了以上的binding之后， 在对应的python解释器生命周期中，可以直接使用  <code>import aiges_embed</code> 导入该c侧定义的Module以及其中的class类。</p><p><a href="https://github.com/xfyun/aiges_c_python_wrapper/blob/master/wrapper.py" target="_blank" rel="noopener noreferrer">wrapper.py</a>向您展示了导入 python侧的实现。</p><p>需要注意的是：</p><p>aiges_embed 库是用宏<code>PYBIND11_EMBEDDED_MODULE</code>在c侧进程中动态定义，因此aiges_embed库无法在本地的python lib目录中找到，这给我们本地调试带来一定的困难，即用户不清楚aige_embed中的DataListNode, DataListCls是如何实现，以及定义的。</p><p>因此，<code>aiges</code>这边做法是创建一个python的 <a href="https://github.com/xfyun/aiges_python" target="_blank" rel="noopener noreferrer">sdk</a>，供用户在使用Pure Python(没有c程序运行环境，只有python)环境调试<code>wrapper.py</code>逻辑.
我们在 <a href="https://github.com/xfyun/aiges_python/blob/master/aiges/dto.py#L51" target="_blank" rel="noopener noreferrer">sdk.dto</a>实现c侧定义的相同类，所以你可以看到 wrapper.py的前两行:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aiges_embed </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ResponseData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DataListNode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DataListCls  </span><span class="token comment" style="color:#999988;font-style:italic"># c++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aiges</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dto </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ResponseData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DataListNode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DataListCls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第一行导入执行成功的条件是,由c进程加载运行此wrapper.py</p><p>第二行导入执行成功的条件是,本地python环境模拟运行 wrapper.py时，此时依赖本地python库是否 安装过aiges依赖</p><p>使用 <code>pip install aiges</code> 即可完成安装。</p><p><strong><em>注意</em></strong> </p><p>肯定有同学比较疑惑这个设计。 这个问题，我没有发现pybind11原生有何更优的解决方案，如有我不知道的，还请各位观众告知。</p><ul><li>Python执行完 wrapperOnceExec,C++如何接受python返回？</li></ul><p>上述描述了C++传入数据到Python，用的是 <code>DataListCls</code>类的绑定， 返回其实也类似，也是实现类似绑定 <code>Response</code>
参见:</p><p><a href="https://github.com/xfyun/aiges_c_python_wrapper/blob/master/pyWrapper.h#L40" target="_blank" rel="noopener noreferrer">pywraper.h</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="aiges-sdk">aiges sdk<a class="hash-link" href="#aiges-sdk" title="Direct link to heading">​</a></h3><p>上述提到的在python的 <a href="https://github.com/xfyun/aiges_python/blob/master/aiges/sdk.py#L714" target="_blank" rel="noopener noreferrer">aiges sdk</a>中， 我们用python实现了对C程序的一个仿真，并且，在sdk中检查用户对 wrapper.py的编写是否有纰漏或者错误，提前暴露wrapper.py可能的编写问题。</p><p>wrapper.py的编写请移步: <a href="https://iflytek.github.io/athena_website/docs/%E5%8A%A0%E8%BD%BD%E5%99%A8/Python%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">实现第一个wrapper.py</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于python插件性能">关于python插件性能<a class="hash-link" href="#关于python插件性能" title="Direct link to heading">​</a></h3><p>一句话，当前状态未正式测试python性能，引用前同事一句话(你都开始用py了还考虑性能？？？)等下，这并不严谨，我道歉。python也是可以实现比较高的性能的， 且听我一段不负责任的嘴遁分析：</p><p>1: 当前主流的python推理实现，最终计算部分还是落在了python中的一些三方科学库中，如numpy，tensorflow等 c实现的类库中。 因此，比较负责任的一段解释是，如果你的推理插件中纯python的逻辑越少，那么理论上性能不会下降太多。一旦有一些复杂逻辑在python中用纯py实现，那么该处一定是一个性能下降点。</p><p>2: 如果ai能力要求输入一些大的二进制，比如图片，音视频，从C的内存到 Python的 bytes内存需要有一次拷贝，可能是一个性能下降点</p><p>3: 多说无益，具体情况具体分析</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于pybind11-提供的零拷贝机制">关于pybind11 提供的零拷贝机制<a class="hash-link" href="#关于pybind11-提供的零拷贝机制" title="Direct link to heading">​</a></h3><p>Python提供了一套 <a href="https://docs.python.org/3/c-api/buffer.html" target="_blank" rel="noopener noreferrer">Buffer Protocol</a>，基于它可以实现内存0拷贝，在不同的C插件中进行转移处理。</p><p>简而言之呢它是个什么玩意呢？ 比如有一个大段的数据快(音视频)，比如将它放在一个 array数组中，现在我们需要用 numpy去加载它，如果这个array数组是原生的python list，那么这一过程必然是有拷贝过程的。但是如果我们在c中利用 <code>buffer protocol</code> 设计出一种数据结构，这个数据结构传递到 numpy处理时，数据块可以直接指针转移，无需做数据拷贝，即可在numpy中处理该数据内存大块， 这在计算推理场景十分有用。</p><p>具体0拷贝以及 buffer protocol 的demo参考:</p><ul><li><p><a href="https://jakevdp.github.io/blog/2014/05/05/introduction-to-the-python-buffer-protocol/#:~:text=The%20Python%20buffer%20protocol%2C%20also,manipulate%20large%20arrays%20of%20data." target="_blank" rel="noopener noreferrer">简易的 buffer protocol demo</a></p></li><li><p><a href="https://pybind11.readthedocs.io/en/stable/advanced/pycpp/numpy.html?highlight=numpy#" target="_blank" rel="noopener noreferrer">pybind11: buffer protocol</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h3><p>利用Python pybind11 我们可以用非常简洁的代码实现 C和python的互调用，这给我们AI工程化提供了更多的可能性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a class="hash-link" href="#特别鸣谢" title="Direct link to heading">​</a></h3><p>本文部分参考(chao): </p><ul><li><a href="https://zhuanlan.zhihu.com/p/444805518" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/444805518</a></li></ul>]]></content>
        <author>
            <name>ybyang7</name>
            <uri>https://github.com/berlinsaint</uri>
        </author>
        <category label="pybind11" term="pybind11"/>
        <category label="ai" term="ai"/>
        <category label="python" term="python"/>
        <category label="athenaserving" term="athenaserving"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[快速部署AthenaServing框架 (Sealos 4.x)]]></title>
        <id>sealos4-athenaserving</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/sealos4-athenaserving"/>
        <updated>2022-07-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[准备一台测试机(4c8G),硬盘>=20G即可]]></summary>
        <content type="html"><![CDATA[<p>准备一台测试机(4c8G),硬盘&gt;=20G即可</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><ol><li>安装sealos.4.0</li></ol><p><code> wget -c https://sealyun-home.oss-cn-beijing.aliyuncs.com/sealos-4.0/latest/sealos-amd64 -O sealos &amp;&amp;  chmod +x sealos &amp;&amp; mv sealos /usr/bin</code></p><ol start="2"><li>创建集群</li></ol><ul><li><code>sealos run labring/kubernetes:v1.19.16 labring/calico:v3.22.1   --masters 192.168.64.2 -p &lt;password&gt;</code></li></ul><p><img loading="lazy" alt="img" src="/athena_website/en/assets/images/sealos4-run-k8s-3c401909adde6b30aa8953c31bfd3291.png" width="1497" height="271" class="img_ev3q">
<img loading="lazy" alt="img2" src="/athena_website/en/assets/images/sealos4-run-k8s-2-97ee55405c9372fe1c382b7fb8f4f002.png" width="1542" height="625" class="img_ev3q">
<img loading="lazy" alt="img2" src="/athena_website/en/assets/images/sealos4-run-k8s-3-844e7986a2f4a037d2a3a9da07e29ba1.png" width="1064" height="469" class="img_ev3q"></p><ul><li><code>sealos run labring/helm:v3.8.2 # install helm</code></li><li><code>sealos run labring/openebs:v1.9.0 # install openebs</code></li><li><code>sealos run registry.cn-qingdao.aliyuncs.com/labring/athenaserving:v2.0.0rc1</code></li></ul><ol start="3"><li>调用AI demo能力 MMOCR能力</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /var/lib/sealos/data/default/rootfs/athenaserving/charts/mmocr_ase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修改 demo.py中的 url部分为 nodeIP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 demo.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调用结果:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP API response is </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'filename'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'result'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">37</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">253</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">31</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">254</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">46</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">191</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9566415548324585</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'nboroughofs'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">253</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">47</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">257</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">36</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">287</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">47</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">282</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">58</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9649642705917358</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'fsouthw'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">157</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">59</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">41</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">194</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">52</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">163</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9521175622940063</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'londond'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9897959183673469</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">280</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">58</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">306</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">67</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">300</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">74</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9397556781768799</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'thwark'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">252</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">295</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">295</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">98</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">252</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">98</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9694718718528748</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hill'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">247</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">247</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">99</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">99</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9548642039299011</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'octavia'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">164</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">105</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">215</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">103</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">216</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">121</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9806956052780151</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'social'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">219</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">104</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">294</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">104</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">294</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">122</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">219</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">122</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9688025116920471</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'reformer'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">150</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">150</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9752051830291748</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'established'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">229</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">255</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">255</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">140</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">229</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">140</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.94972825050354</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'this'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">259</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">125</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">305</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">123</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">306</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">260</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9752089977264404</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'garden'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.1666666666666667</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">166</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">193</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">194</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">167</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9731062650680542</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hall'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">198</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">198</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9548938870429993</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'and'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">228</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">144</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">144</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">159</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">228</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">159</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.977089524269104</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'cottages'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.25</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">205</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">205</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9400062561035156</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'and'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">160</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">279</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">279</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">174</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9543584585189819</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'pioneered'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">176</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">277</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">176</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">277</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9748533964157104</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'cadets'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">183</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">177</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">177</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">189</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">183</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">189</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9633153676986694</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'army'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">235</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">235</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">204</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">204</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9714152216911316</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1887'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.25</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">175</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">211</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">212</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">206</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">225</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9704344868659973</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vted'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9191176470588236</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">241</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">278</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">200</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">283</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">246</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">227</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9607459902763367</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'epeople'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">208</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">224</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">212</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">220</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">227</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9337806701660156</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'by'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'box'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">240</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">240</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'box_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.969144344329834</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'the'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'text_score'</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">########################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">37</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">253</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">31</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">254</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">46</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">191</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9566415548324585</span><span class="token plain">.  Detected text is nboroughofs , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">253</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">47</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">257</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">36</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">287</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">47</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">282</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">58</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9649642705917358</span><span class="token plain">.  Detected text is fsouthw , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">157</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">59</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">41</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">194</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">52</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">163</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9521175622940063</span><span class="token plain">.  Detected text is londond , text  score is </span><span class="token number" style="color:#36acaa">0.9897959183673469</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">280</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">58</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">306</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">67</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">300</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">74</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9397556781768799</span><span class="token plain">.  Detected text is thwark , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">252</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">295</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">295</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">98</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">252</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">98</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9694718718528748</span><span class="token plain">.  Detected text is hill , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">247</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">78</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">247</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">99</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">99</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9548642039299011</span><span class="token plain">.  Detected text is octavia , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">164</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">105</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">215</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">103</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">216</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">121</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">165</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9806956052780151</span><span class="token plain">.  Detected text is social , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">219</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">104</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">294</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">104</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">294</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">122</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">219</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">122</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9688025116920471</span><span class="token plain">.  Detected text is reformer , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">150</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">150</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9752051830291748</span><span class="token plain">.  Detected text is established , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">229</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">255</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">124</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">255</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">140</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">229</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">140</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.94972825050354</span><span class="token plain">.  Detected text is this , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">259</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">125</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">305</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">123</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">306</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">260</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9752089977264404</span><span class="token plain">.  Detected text is garden , text  score is </span><span class="token number" style="color:#36acaa">1.1666666666666667</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">166</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">193</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">141</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">194</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">167</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">157</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9731062650680542</span><span class="token plain">.  Detected text is hall , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">198</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">142</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">198</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">156</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9548938870429993</span><span class="token plain">.  Detected text is and , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">228</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">144</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">144</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">286</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">159</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">228</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">159</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.977089524269104</span><span class="token plain">.  Detected text is cottages , text  score is </span><span class="token number" style="color:#36acaa">1.25</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">205</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">205</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9400062561035156</span><span class="token plain">.  Detected text is and , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">160</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">279</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">158</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">279</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">172</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">174</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9543584585189819</span><span class="token plain">.  Detected text is pioneered , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">176</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">277</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">176</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">277</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">188</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9748533964157104</span><span class="token plain">.  Detected text is cadets , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">183</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">177</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">177</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">189</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">183</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">189</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9633153676986694</span><span class="token plain">.  Detected text is army , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">235</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">190</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">235</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">204</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">204</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9714152216911316</span><span class="token plain">.  Detected text is </span><span class="token number" style="color:#36acaa">1887</span><span class="token plain"> , text  score is </span><span class="token number" style="color:#36acaa">1.25</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">175</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">180</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">201</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">211</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">212</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">206</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">225</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9704344868659973</span><span class="token plain">.  Detected text is vted , text  score is </span><span class="token number" style="color:#36acaa">0.9191176470588236</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">241</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">278</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">200</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">283</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">213</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">246</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">227</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9607459902763367</span><span class="token plain">.  Detected text is epeople , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">208</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">224</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">210</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">212</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">220</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">227</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.9337806701660156</span><span class="token plain">.  Detected text is by , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MMocr Result: box located at </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">240</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">214</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">240</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">223</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">226</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, box score is </span><span class="token number" style="color:#36acaa">0.969144344329834</span><span class="token plain">.  Detected text is the , text  score is </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>ybyang7</name>
            <uri>https://github.com/berlinsaint</uri>
        </author>
        <category label="sealos" term="sealos"/>
        <category label="ai" term="ai"/>
        <category label="sealos4" term="sealos4"/>
        <category label="athenaserving" term="athenaserving"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[快速创建k8s集群(sealos3 on aws)]]></title>
        <id>aws-sealos-3</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/aws-sealos-3"/>
        <updated>2022-07-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[1. 在aws上申请服务器资源]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-在aws上申请服务器资源">1. 在aws上申请服务器资源<a class="hash-link" href="#1-在aws上申请服务器资源" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="img" src="/athena_website/en/assets/images/aws-e0957b7cf0eafb47cd2466bfff807802.png" width="1655" height="63" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-使用sealos部署k8s集群">2. 使用sealos部署k8s集群<a class="hash-link" href="#2-使用sealos部署k8s集群" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-关闭防火墙和selinux-all">2.1. 关闭防火墙和selinux :All<a class="hash-link" href="#21-关闭防火墙和selinux-all" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop firewalld </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable firewalld </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setenforce 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-创建虚拟机之后配置主机名配置内网解析all">2.2 创建虚拟机之后，配置主机名，配置内网解析:All<a class="hash-link" href="#22-创建虚拟机之后配置主机名配置内网解析all" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hostnamectl set-hostname master </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostnamectl set-hostname node1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="23配置hosts文件master">2.3.配置hosts文件:Master<a class="hash-link" href="#23配置hosts文件master" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 节点ip通过各节点ipconfig获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; /etc/hosts  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">172.31.1.36 master  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">172.31.11.161 node1   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="24配置master免密登录各节点master">2.4.配置master免密登录各节点：Master<a class="hash-link" href="#24配置master免密登录各节点master" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id root@master </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id root@node1 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="25-下载并安装sealos-39并部署一个一主一从的k8s集群">2.5. 下载并安装sealos-3.9并部署一个一主一从的k8s集群<a class="hash-link" href="#25-下载并安装sealos-39并部署一个一主一从的k8s集群" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 下载sealos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget -c https://sealyun-home.oss-cn-beijing.aliyuncs.com/sealos/latest/sealos &amp;&amp; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chmod +x sealos &amp;&amp; mv sealos /usr/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载kubelete-1.22版本离线资源包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/05a3db657821277f5f3b92d834bbaf98-v1.22.0/kube1.22.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 部署k8s集群</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealos init \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--passwd 123456 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--master 172.31.1.36 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--node 172.31.11.161 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--pkg-url /home/ubuntu/kube1.22.0.tar.gz \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--version v1.22.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="26-安裝helm">2.6. 安裝helm<a class="hash-link" href="#26-安裝helm" title="Direct link to heading">​</a></h4><ul><li>Download your desired version (wget  <a href="https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz" target="_blank" rel="noopener noreferrer">https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz</a>)</li><li>Unpack it (tar -zxvf helm-v3.9.0-linux-amd64.tar.gz)</li><li>Find the helm binary in the unpacked directory, and move it to its desireddestination (mv linux-amd64/helm /usr/local/bin/helm)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="27-helm安装本地持久化存储openebs服务">2.7 helm安装本地持久化存储openebs服务<a class="hash-link" href="#27-helm安装本地持久化存储openebs服务" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm add repo openebs https://openebs.github.io/charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm pull openebs/openebs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改服务对应的storageclass即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#默认持久化数据地址：/var/openebs/local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装openebs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install ebs openebs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="28-通过helm安装athena服务">2.8. 通过helm安装athena服务<a class="hash-link" href="#28-通过helm安装athena服务" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/sea-wyq/Athena_deploy.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd Athena_deploy/chart/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install athena athenaserving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>服务集群搭建成功。。。</p>]]></content>
        <author>
            <name>sea-wyq</name>
            <uri>https://github.com/sea-wyq</uri>
        </author>
        <category label="sealos" term="sealos"/>
        <category label="aws" term="aws"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Welcome]]></title>
        <id>welcome</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/welcome"/>
        <updated>2021-08-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Welcome to contribute AthenaServing Docs and Blogs.]]></summary>
        <content type="html"><![CDATA[<p>Welcome to contribute AthenaServing Docs and Blogs.</p>]]></content>
        <author>
            <name>ybyang7</name>
            <uri>https://github.com/berlinsaint</uri>
        </author>
        <author>
            <name>sea-wyq</name>
            <uri>https://github.com/sea-wyq</uri>
        </author>
        <author>
            <name>jhr</name>
            <uri>https://github.com/robbinlol</uri>
        </author>
        <category label="opensource" term="opensource"/>
        <category label="athenaserving" term="athenaserving"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[First Blog Post]]></title>
        <id>first-blog-post</id>
        <link href="https://iflytek.github.io/athena_website/en/blog/first-blog-post"/>
        <updated>2019-05-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet 。]]></summary>
        <content type="html"><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet 。</p>]]></content>
        <author>
            <name>Gao Wei</name>
            <uri>https://github.com/wgao19</uri>
        </author>
        <category label="hola" term="hola"/>
        <category label="docusaurus" term="docusaurus"/>
    </entry>
</feed>